/*
 * Copyright (c) 2021. AppDynamics LLC and its affiliates.
 * All rights reserved.
 *
 */

/*
 * This file was generated by the Gradle 'init' task.
 *
 * This is a general purpose Gradle build.
 * Learn more about Gradle by exploring our samples at https://docs.gradle.org/7.0.2/samples
 */

def test_driver_path = "test_driver/integration_test.dart"
def integration_tests_path = "integration_test/"
def iOS_device = "iPhone 12"
def android_device = "sdk gphone x86 arm"

ext.execPath = "$System.env.PATH" + System.getProperty("path.separator") + "$projectDir/../flutter/bin"

task buildiOS(type: Exec) {
    environment "PATH", execPath
    commandLine "../scripts/flutter-build-ios.sh"
}

task buildAndroid(type: Exec) {
    environment "PATH", execPath
    commandLine "../scripts/flutter-build-android.sh"
}

task runIntegrationTestsiOS {
    doLast {
        exec {
            commandLine "flutter", "drive", "--driver", test_driver_path, "--target",
                    integration_tests_path + "start_test.dart", "-d", iOS_device
        }
    }
}

task runIntegrationTestsAndroid {
    doLast {
        exec {
            commandLine "flutter", "drive", "--driver", test_driver_path, "--target",
                    integration_tests_path + "/start_test.dart", "-d", android_device
        }
    }
}

task generateMocks(type: Exec) {
    commandLine "flutter", "pub", "run", "build_runner", "build"
}

