/*
 * Copyright (c) 2021. AppDynamics LLC and its affiliates.
 * All rights reserved.
 *
 */

/*
 * This file was generated by the Gradle 'init' task.
 *
 * This is a general purpose Gradle build.
 * Learn more about Gradle by exploring our samples at https://docs.gradle.org/7.0.2/samples
 */

plugins {
    id 'java-library'
    id 'com.appdynamics.gradle.plugins.appd-publish' version '2.2.22'
    id 'com.appdynamics.gradle.plugins.pipeline.pipelinePlugin' version '3.5.179'
    id 'org.sonarqube' version '3.2.0'
}

// pipelinePlugin
pipeline {
    teamcityParent = "EUM"
    projectName = "Flutter Agent"

    buildTasks = ["build", "downloadFlutter", "installPackages", "analyze", "runTests", ":example:buildAndroid"]
}

// appd-publish
group = 'com.appdynamics.eum'
appdVersion {
    baseVersion = '1.0'
}

sonarqube {
    properties {
        property "sonar.projectName", project.name
        property "sonar.projectVersion", version
    }
}

def execPath = "$System.env.PATH" + System.getProperty("path.separator") + "$projectDir/flutter/bin"

task downloadFlutter(type: Exec) {
    commandLine "./scripts/flutter-download.sh"
}

task installPackages(type: Exec) {
    environment "PATH", execPath
    commandLine "./scripts/flutter-get.sh"
}

task analyze(type: Exec) {
    environment "PATH", execPath
    commandLine "./scripts/flutter-analyze.sh"
}

task runTests(type: Exec) {
    environment "PATH", execPath
    commandLine "./scripts/flutter-test.sh"
}